<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/main :: html}">
<body>
<div th:fragment="content">

    <!-- Page Header -->
    <div class="ai-page-header mb-4">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h4 class="mb-1">
                    <i class="fas fa-brain text-success me-2"></i>
                    AI Insights - Ph&#226;n t&#237;ch th&#244;ng minh
                    <span class="badge bg-success ms-2 ai-badge-glow">AI Powered</span>
                </h4>
                <p class="text-muted mb-0">S&#7917; d&#7909;ng tr&#237; tu&#7879; nh&#226;n t&#7841;o &#273;&#7875; ph&#226;n t&#237;ch v&#224; d&#7921; &#273;o&#225;n t&#7891;n kho</p>
            </div>
        </div>
    </div>

    <!-- AI Feature Cards -->
    <div class="row g-4 mb-4">
        <!-- Demand Forecasting -->
        <div class="col-md-4">
            <div class="card ai-feature-card ai-card-forecast h-100">
                <div class="card-body text-center">
                    <div class="ai-icon-wrapper bg-primary-subtle rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                        <i class="fas fa-chart-line fa-2x text-primary"></i>
                    </div>
                    <h5 class="fw-bold">D&#7921; &#273;o&#225;n nhu c&#7847;u</h5>
                    <p class="text-muted">D&#7921; &#273;o&#225;n nhu c&#7847;u t&#7891;n kho d&#7921;a tr&#234;n d&#7919; li&#7879;u l&#7883;ch s&#7917; v&#224; xu h&#432;&#7899;ng th&#7883; tr&#432;&#7901;ng</p>
                    <a th:href="@{/ai/forecast}" class="btn btn-primary">
                        <i class="fas fa-chart-line me-1"></i>D&#7921; &#273;o&#225;n ngay
                    </a>
                </div>
            </div>
        </div>

        <!-- Reorder Suggestions -->
        <div class="col-md-4">
            <div class="card ai-feature-card ai-card-reorder h-100">
                <div class="card-body text-center">
                    <div class="ai-icon-wrapper bg-success-subtle rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                        <i class="fas fa-cart-plus fa-2x text-success"></i>
                    </div>
                    <h5 class="fw-bold">&#272;&#7873; xu&#7845;t &#273;&#7863;t h&#224;ng</h5>
                    <p class="text-muted">G&#7907;i &#253; s&#7843;n ph&#7849;m c&#7847;n &#273;&#7863;t h&#224;ng l&#7841;i d&#7921;a tr&#234;n m&#7913;c t&#7891;n kho v&#224; t&#7889;c &#273;&#7897; ti&#234;u th&#7909;</p>
                    <button class="btn btn-success" onclick="loadReorderSuggestions()">
                        <i class="fas fa-sync me-1"></i>T&#7843;i &#273;&#7873; xu&#7845;t
                    </button>
                </div>
            </div>
        </div>

        <!-- Anomaly Detection -->
        <div class="col-md-4">
            <div class="card ai-feature-card ai-card-anomaly h-100">
                <div class="card-body text-center">
                    <div class="ai-icon-wrapper bg-danger-subtle rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                        <i class="fas fa-exclamation-circle fa-2x text-danger"></i>
                    </div>
                    <h5 class="fw-bold">Ph&#225;t hi&#7879;n b&#7845;t th&#432;&#7901;ng</h5>
                    <p class="text-muted">T&#7921; &#273;&#7897;ng ph&#225;t hi&#7879;n c&#225;c b&#7845;t th&#432;&#7901;ng trong bi&#7871;n &#273;&#7897;ng t&#7891;n kho v&#224; giao d&#7883;ch</p>
                    <button class="btn btn-danger" onclick="loadAnomalies()">
                        <i class="fas fa-search me-1"></i>Ki&#7875;m tra
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reorder Suggestions Section -->
    <div class="card shadow-sm mb-4" id="reorderSection">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
            <h6 class="mb-0 fw-bold">
                <i class="fas fa-cart-plus text-success me-2"></i>
                &#272;&#7873; xu&#7845;t &#273;&#7863;t h&#224;ng l&#7841;i
            </h6>
            <button class="btn btn-sm btn-outline-success" onclick="loadReorderSuggestions()">
                <i class="fas fa-sync-alt me-1"></i>L&#224;m m&#7899;i
            </button>
        </div>
        <div class="card-body" id="reorderContent">
            <div class="text-center py-4 text-muted" id="reorderPlaceholder">
                <i class="fas fa-robot fa-3x mb-3 d-block text-success"></i>
                <p>Nh&#7845;n "T&#7843;i &#273;&#7873; xu&#7845;t" &#273;&#7875; AI ph&#226;n t&#237;ch v&#224; g&#7907;i &#253; s&#7843;n ph&#7849;m c&#7847;n &#273;&#7863;t h&#224;ng</p>
            </div>
            <div id="reorderLoading" style="display: none;" class="text-center py-4">
                <div class="spinner-border text-success" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2 text-muted">AI &#273;ang ph&#226;n t&#237;ch d&#7919; li&#7879;u...</p>
            </div>
            <div id="reorderResults" style="display: none;">
                <div class="table-responsive">
                    <table class="table table-hover mb-0" id="reorderTable">
                        <thead class="table-light">
                            <tr>
                                <th>S&#7843;n ph&#7849;m</th>
                                <th>SKU</th>
                                <th class="text-center">T&#7891;n kho</th>
                                <th class="text-center">&#272;&#7873; xu&#7845;t &#273;&#7863;t</th>
                                <th class="text-center">&#272;&#7897; tin c&#7853;y</th>
                                <th>L&#253; do</th>
                                <th class="text-center">Thao t&#225;c</th>
                            </tr>
                        </thead>
                        <tbody id="reorderTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Anomaly Detection Section -->
    <div class="card shadow-sm mb-4" id="anomalySection">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
            <h6 class="mb-0 fw-bold">
                <i class="fas fa-exclamation-circle text-danger me-2"></i>
                Ph&#225;t hi&#7879;n b&#7845;t th&#432;&#7901;ng
            </h6>
            <button class="btn btn-sm btn-outline-danger" onclick="loadAnomalies()">
                <i class="fas fa-sync-alt me-1"></i>L&#224;m m&#7899;i
            </button>
        </div>
        <div class="card-body" id="anomalyContent">
            <div class="text-center py-4 text-muted" id="anomalyPlaceholder">
                <i class="fas fa-shield-alt fa-3x mb-3 d-block text-danger"></i>
                <p>Nh&#7845;n "Ki&#7875;m tra" &#273;&#7875; AI qu&#233;t c&#225;c b&#7845;t th&#432;&#7901;ng</p>
            </div>
            <div id="anomalyLoading" style="display: none;" class="text-center py-4">
                <div class="spinner-border text-danger" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2 text-muted">AI &#273;ang qu&#233;t d&#7919; li&#7879;u...</p>
            </div>
            <div id="anomalyResults" style="display: none;" class="row g-3">
            </div>
        </div>
    </div>

    <!-- Natural Language Query Section -->
    <div class="card shadow-sm ai-query-section">
        <div class="card-header bg-white">
            <h6 class="mb-0 fw-bold">
                <i class="fas fa-comment-dots text-primary me-2"></i>
                H&#7887;i AI v&#7873; kho h&#224;ng
            </h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-8">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control form-control-lg" id="aiQueryInput"
                               placeholder="H&#7887;i b&#7857;ng ti&#7871;ng Vi&#7879;t ho&#7863;c ti&#7871;ng Anh..."/>
                        <button class="btn btn-primary btn-lg" type="button" id="askAiBtn" onclick="askAi()">
                            <i class="fas fa-paper-plane me-1"></i>H&#7887;i AI
                        </button>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted me-2">G&#7907;i &#253;:</small>
                        <span class="badge bg-light text-dark me-1 cursor-pointer ai-query-chip"
                              onclick="setQuery(this.textContent)">S&#7843;n ph&#7849;m n&#224;o s&#7855;p h&#7871;t h&#224;ng?</span>
                        <span class="badge bg-light text-dark me-1 cursor-pointer ai-query-chip"
                              onclick="setQuery(this.textContent)">Top 10 s&#7843;n ph&#7849;m b&#225;n ch&#7841;y</span>
                        <span class="badge bg-light text-dark me-1 cursor-pointer ai-query-chip"
                              onclick="setQuery(this.textContent)">Kho n&#224;o c&#242;n nhi&#7873;u ch&#7895; tr&#7889;ng?</span>
                        <span class="badge bg-light text-dark me-1 cursor-pointer ai-query-chip"
                              onclick="setQuery(this.textContent)">D&#7921; b&#225;o doanh thu th&#225;ng t&#7899;i</span>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card bg-light">
                        <div class="card-body">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                AI c&#243; th&#7875; tr&#7843; l&#7901;i c&#225;c c&#226;u h&#7887;i v&#7873; t&#7891;n kho, xu h&#432;&#7899;ng b&#225;n h&#224;ng, d&#7921; &#273;o&#225;n nhu c&#7847;u v&#224; nhi&#7873;u th&#244;ng tin kh&#225;c.
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Response Area -->
            <div id="aiQueryLoading" style="display: none;" class="text-center py-3">
                <div class="spinner-border text-primary" role="status"></div>
                <p class="mt-2 text-muted">AI &#273;ang x&#7917; l&#253;...</p>
            </div>
            <div id="aiQueryResponse" style="display: none;" class="mt-3">
                <div class="card border-start border-4 border-primary">
                    <div class="card-body">
                        <div class="d-flex align-items-start mb-2">
                            <i class="fas fa-robot text-primary me-2 mt-1"></i>
                            <strong>AI Tr&#7843; l&#7901;i:</strong>
                        </div>
                        <div id="aiResponseText" class="ms-4"></div>
                        <div id="aiResponseMeta" class="ms-4 mt-2 text-muted small"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<th:block th:fragment="scripts">
    <script th:src="@{/js/ai-insights.js}"></script>
</th:block>

</body>
</html>
